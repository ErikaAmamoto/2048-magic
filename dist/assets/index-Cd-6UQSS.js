(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();let f=JSON.parse(localStorage.getItem("gameBoard"))||[],c=parseInt(localStorage.getItem("currentScore"))||0,d=parseInt(localStorage.getItem("bestScore"))||0,m=JSON.parse(localStorage.getItem("historyStack"))||[];const N=["left","left","right","right","right","right","left","left"];let g=[];function x(){const r=Array(4).fill().map(()=>Array(4).fill(0));return p(r),p(r),r}function p(r){const t=[];for(let e=0;e<4;e++)for(let l=0;l<4;l++)r[e][l]===0&&t.push([e,l]);if(t.length){const[e,l]=t[Math.floor(Math.random()*t.length)];r[e][l]=Math.random()<.9?2:4}}function v(r,t){const e=r.map(n=>[...n]),l=Array(4).fill().map(()=>Array(4).fill(!1));if(t==="up"){for(let n=0;n<4;n++)for(let s=1;s<4;s++)if(e[s][n]!==0){let o=s;for(;o>0&&e[o-1][n]===0;)e[o-1][n]=e[o][n],e[o][n]=0,o--;o>0&&e[o-1][n]===e[o][n]&&!l[o-1][n]&&(e[o-1][n]*=2,e[o][n]=0,l[o-1][n]=!0)}}else if(t==="down"){for(let n=0;n<4;n++)for(let s=2;s>=0;s--)if(e[s][n]!==0){let o=s;for(;o<3&&e[o+1][n]===0;)e[o+1][n]=e[o][n],e[o][n]=0,o++;o<3&&e[o+1][n]===e[o][n]&&!l[o+1][n]&&(e[o+1][n]*=2,e[o][n]=0,l[o+1][n]=!0)}}else if(t==="left"){for(let n=0;n<4;n++)for(let s=1;s<4;s++)if(e[n][s]!==0){let o=s;for(;o>0&&e[n][o-1]===0;)e[n][o-1]=e[n][o],e[n][o]=0,o--;o>0&&e[n][o-1]===e[n][o]&&!l[n][o-1]&&(e[n][o-1]*=2,e[n][o]=0,l[n][o-1]=!0)}}else if(t==="right"){for(let n=0;n<4;n++)for(let s=2;s>=0;s--)if(e[n][s]!==0){let o=s;for(;o<3&&e[n][o+1]===0;)e[n][o+1]=e[n][o],e[n][o]=0,o++;o<3&&e[n][o+1]===e[n][o]&&!l[n][o+1]&&(e[n][o+1]*=2,e[n][o]=0,l[n][o+1]=!0)}}return JSON.stringify(e)!==JSON.stringify(r)&&p(e),e}function O(r){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(r[t][e]===0)return!1;for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(e<3&&r[t][e]===r[t][e+1]||t<3&&r[t][e]===r[t+1][e])return!1;return!0}async function w(){f=x(),c=0;const r=parseInt(document.getElementById("best-score").textContent)||0;d=Math.max(parseInt(localStorage.getItem("bestScore")||0),r),localStorage.setItem("bestScore",d),m=[],h(),document.getElementById("current-score").textContent=c,document.getElementById("best-score").textContent=d,I()}function h(){const r=document.getElementById("grid-container");r.innerHTML="";for(let t=0;t<4;t++)for(let e=0;e<4;e++){const l=document.createElement("div");l.className="cell",l.dataset.row=t,l.dataset.col=e,f[t][e]!==0&&(l.textContent=f[t][e],l.classList.add(`tile-${f[t][e]}`)),r.appendChild(l)}S()}function S(){const r=document.querySelectorAll(".cell"),e=document.getElementById("grid-container").offsetWidth/4*.9;r.forEach(l=>{l.textContent&&(l.textContent.length<=2?l.style.fontSize=`${e*.5}px`:l.textContent.length===3?l.style.fontSize=`${e*.4}px`:l.style.fontSize=`${e*.3}px`)})}function I(){localStorage.setItem("gameBoard",JSON.stringify(f)),localStorage.setItem("currentScore",c),localStorage.setItem("bestScore",d),localStorage.setItem("historyStack",JSON.stringify(m))}function C(r,t,e){const l=Array(4).fill().map(()=>Array(4).fill(!1)),i=e==="down"?[3,2,1,0]:[0,1,2,3],n=e==="right"?[3,2,1,0]:[0,1,2,3];if(e==="left"||e==="right"){for(let s=0;s<4;s++)for(let o of n)if(t[s][o]!==0&&t[s][o]===r[s][o]*2){const a=r[s][o],y=t[s][o];a!==0&&y===a*2&&(l[s][o]=!0)}}else for(let s=0;s<4;s++)for(let o of i)if(t[o][s]!==0&&t[o][s]===r[o][s]*2){const a=r[o][s],y=t[o][s];a!==0&&y===a*2&&(l[o][s]=!0)}return l}function J(r,t,e){const l=C(r,t,e);let i=0;for(let n=0;n<4;n++)for(let s=0;s<4;s++)l[n][s]&&(i+=t[n][s]);return i}async function u(r){if(m.push({board:JSON.parse(JSON.stringify(f)),score:c}),localStorage.setItem("historyStack",JSON.stringify(m)),g.push(r),g.length>8&&g.shift(),JSON.stringify(g)===JSON.stringify(N)){A();return}const t=JSON.parse(JSON.stringify(f)),e=v(t,r);if(JSON.stringify(e)!==JSON.stringify(t)){const i=J(t,e,r);c+=i,document.getElementById("current-score").textContent=c,c>d&&(d=c,localStorage.setItem("bestScore",d),document.getElementById("best-score").textContent=d),f=e,I(),L(t,e,r)}O(e)&&setTimeout(()=>{j(),document.getElementById("undo-button").style.position="relative",document.getElementById("undo-button").style.zIndex="20"},300)}function L(r,t,e){const l=document.getElementById("grid-container"),i=Array.from(l.querySelectorAll(".cell")),n=C(r,t,e);i.forEach(s=>{const o=parseInt(s.dataset.row),a=parseInt(s.dataset.col);t[o][a]!==r[o][a]&&(t[o][a]!==0?n[o][a]?(s.textContent=t[o][a],s.className=`cell tile-${t[o][a]} pulse`,s.addEventListener("animationend",()=>{s.classList.remove("pulse")},{once:!0})):r[o][a]===0?(s.textContent=t[o][a],s.className=`cell tile-${t[o][a]} appear`,s.addEventListener("animationend",()=>{s.classList.remove("appear")},{once:!0})):(s.textContent=t[o][a],s.className=`cell tile-${t[o][a]}`):(s.textContent="",s.className="cell"))}),S()}function A(){M();const r=document.getElementById("game-container"),t=document.createElement("div");t.id="cheat-notification",t.textContent="Cheat mode activated!",t.style.position="absolute",t.style.top="10px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.backgroundColor="rgba(255, 0, 0, 0.7)",t.style.color="white",t.style.padding="10px 20px",t.style.borderRadius="5px",t.style.zIndex="100",r.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}function M(){for(let r=0;r<4;r++)for(let t=0;t<4;t++)f[r][t]!==0&&(f[r][t]=128);h()}function k(){if(m.length===0){alert("No moves to undo!");return}const r=document.getElementById("game-over-modal");r.style.display==="block"&&(r.style.display="none");const t=m.pop();f=t.board,c=t.score,h(),document.getElementById("current-score").textContent=c,I()}function j(){const r=document.getElementById("game-over-modal");r.style.display="block",document.getElementById("undo-button").style.zIndex="20"}document.addEventListener("keydown",r=>{switch(r.key){case"ArrowUp":u("up");break;case"ArrowDown":u("down");break;case"ArrowLeft":u("left");break;case"ArrowRight":u("right");break;case"z":k();break}});let b=0,E=0;document.addEventListener("touchstart",r=>{b=r.touches[0].clientX,E=r.touches[0].clientY});document.addEventListener("touchend",r=>{const t=r.changedTouches[0].clientX,e=r.changedTouches[0].clientY,l=t-b,i=e-E;Math.abs(l)<20&&Math.abs(i)<20||(Math.abs(l)>Math.abs(i)?l>0?u("right"):u("left"):i>0?u("down"):u("up"))});window.addEventListener("resize",S);window.addEventListener("load",()=>{const r=localStorage.getItem("gameBoard");r&&r!=="[]"?(f=JSON.parse(r),c=parseInt(localStorage.getItem("currentScore"))||0,d=parseInt(localStorage.getItem("bestScore"))||0,m=JSON.parse(localStorage.getItem("historyStack"))||[],h(),document.getElementById("current-score").textContent=c,document.getElementById("best-score").textContent=d):w()});
